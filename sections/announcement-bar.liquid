{%- if section.settings.announcement_bar -%}
  {%- liquid
    assign announcement_bar_layout = section.settings.announcement_bar_layout
    assign speed = section.settings.speed
    assign sticky_announcement_bar = section.settings['sticky_announcement-bar']
    assign direction = section.settings.direction
    assign show_announcement_bar = true

    assign autoplay = section.settings.autoplay
    if section.settings.announcement_bar_homepage_only
      if template == 'index'
        assign show_announcement_bar = true
      else
        assign show_announcement_bar = false
      endif
    endif

    if autoplay
      assign autoplay = section.settings.autoplay_length | times: 1000
    endif
  -%}

  {%- if show_announcement_bar -%}
    {{- 'announcement-bar.css' | asset_url | stylesheet_tag -}}

    <div id="shopify-section-{{ section.id }}" class="announcement-bar-section {% if sticky_announcement_bar %}announcement-bar-section--sticky{% endif %}">
    <div class="announcement-bar {% if sticky_announcement_bar %}announcement-bar--fixed{% endif %}"
         role="region"
         aria-label="Announcement bar"
         style="background-color: {{ section.settings.announcement_bg }}; color: {{ section.settings.announcement_text }};">
      <div class="announcement-bar--inner direction-{{ direction }} announcement-bar--{{ announcement_bar_layout }}" style="--marquee-speed: {{ speed }}">
        {%- if announcement_bar_layout == 'marquee' -%}
          {%- capture scrolling_text -%}
            <div>
              {%- liquid
                assign index = 0
                assign size = section.blocks.size
              -%}
              {%- for index in (0..size) -%}
                <div class="announcement-bar--item {% if section.blocks[index].settings.hide_on_desktop %}hide-desktop{% endif %} {% if section.blocks[index].settings.hide_on_mobile %}hide-mobile{% endif %}" {{ section.blocks[index].shopify_attributes }} >
                  {%- if section.blocks[index].settings.link -%}<a href="{{ section.blocks[index].settings.link }}" target="_blank">{%- endif -%}
                    {%- if section.blocks[index].settings.icon -%}{% render 'svg-icons-inline', icon: section.blocks[index].settings.icon %}{%- endif -%}
                    {{- section.blocks[index].settings.text -}}
                  {%- if section.blocks[index].settings.link -%}</a>{%- endif -%}
                </div>
              {%- endfor -%}
            </div>
          {%- endcapture -%}
          {{ scrolling_text }}{{ scrolling_text }}{{ scrolling_text }}
        {%- elsif announcement_bar_layout == 'carousel' -%}
          <slide-show class="carousel" data-autoplay="{{ autoplay }}">
            {%- for block in section.blocks -%}
              <div class="announcement-bar--item carousel__slide {% if block.settings.hide_on_desktop %}hide-desktop{% endif %} {% if block.settings.hide_on_mobile %}hide-mobile{% endif %}" {{ block.shopify_attributes }}>
                {%- if block.settings.link -%}<a href="{{ block.settings.link }}" target="_blank">{%- endif -%}
                  {%- if block.settings.icon -%}{% render 'svg-icons-inline', icon: block.settings.icon %}{%- endif -%}
                  {{- block.settings.text -}}
                {%- if block.settings.link -%}</a>{%- endif -%}
              </div>
            {%- endfor -%}
            {%- if section.blocks.size > 1 -%}
              <div class="flickity-nav flickity-prev" tabindex="0">{% render 'svg-icons' with 'thb-caret-left' %}</div>
              <div class="flickity-nav flickity-next" tabindex="0">{% render 'svg-icons' with 'thb-caret-right' %}</div>
            {%- endif -%}
          </slide-show>
        {%- elsif announcement_bar_layout == 'stacked' -%}
          {%- comment -%} NUEVO LAYOUT: STACKED (apilado verticalmente) CON COLORES INDEPENDIENTES {%- endcomment -%}
          <div class="announcement-bar--stacked">
            {%- for block in section.blocks -%}
              <div class="announcement-bar--item {% if block.settings.hide_on_desktop %}hide-desktop{% endif %} {% if block.settings.hide_on_mobile %}hide-mobile{% endif %}" 
                   {{ block.shopify_attributes }}
                   style="background-color: {{ block.settings.item_bg_color }}; color: {{ block.settings.item_text_color }}; --hover-bg: {{ block.settings.item_hover_bg_color }}; --hover-text: {{ block.settings.item_hover_text_color }}; font-size: {{ block.settings.font_size }}px; font-weight: {{ block.settings.font_weight }};">
                {%- if block.settings.link -%}<a href="{{ block.settings.link }}" target="_blank" style="color: {{ block.settings.item_text_color }};">{%- endif -%}
                  {%- if block.settings.icon -%}{% render 'svg-icons-inline', icon: block.settings.icon %}{%- endif -%}
                  {{- block.settings.text -}}
                {%- if block.settings.link -%}</a>{%- endif -%}
              </div>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
      </div>
    </div>

    <style>
      /* Eliminar espacio blanco - remover padding-top del body */
      body {
        padding-top: 0 !important;
      }

      /* Barra sticky - aplicar al contenedor de la secci√≥n */
      .announcement-bar-section--sticky {
        position: sticky !important;
        top: 0 !important;
        z-index: 52 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .announcement-bar--fixed {
        position: relative !important;
        width: 100% !important;
        margin: 0 !important;
        box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      }

      /* Asegurar que el contenedor interno se mueva con el sticky */
      .announcement-bar--fixed .announcement-bar--inner {
        position: relative;
        z-index: 1;
      }

      /* ajustes visuales */
      .announcement-bar {
        background: var(--color-announcement-bar-bg, var(--color-accent));
        color: var(--color-announcement-bar-text, #fff);
        line-height: 1;
      }
      
      /* Desktop styles */
      @media (min-width: 769px) {
        .announcement-bar {
          background: var(--color-announcement-bar-bg, var(--color-accent));
          color: var(--color-announcement-bar-text, #fff);
          line-height: 1;
          padding: 4px 0;
        }
      }
      
      /* Mobile styles */
      @media (max-width: 768px) {
        .announcement-bar {
          padding: 6px 0;
        }
      }
      
      .announcement-bar .announcement-bar--inner { display:flex; align-items:center; }
      
      /* Eliminar padding cuando es Stacked para que no se vea el fondo */
      .announcement-bar--stacked { padding: 0 !important; }
      .announcement-bar.announcement-bar--stacked-parent { padding: 0 !important; }
      .announcement-bar a { color: inherit; text-decoration: none; }

      /* Eliminar padding cuando es layout Stacked */
      .announcement-bar--inner.announcement-bar--stacked { 
        padding: 0 !important; 
      }
      
      .announcement-bar-section--stacked .announcement-bar {
        padding: 0 !important;
      }

      /* NUEVO: Estilos para layout apilado */
      .announcement-bar--stacked {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0; /* Sin espacio entre textos */
      }

      .announcement-bar--stacked .announcement-bar--item {
        width: 100%;
        text-align: center;
        padding: 0.6em 20px;
        white-space: normal !important;
        display: block !important;
      }

      .announcement-bar--stacked .announcement-bar--item a {
        display: inline;
        white-space: normal;
      }

      /* Hover effect para items con link en layout Stacked */
      .announcement-bar--stacked .announcement-bar--item a:hover {
        background-color: var(--hover-bg) !important;
        color: var(--hover-text) !important;
        transition: background-color 0.3s ease, color 0.3s ease;
        cursor: pointer;
      }

      .announcement-bar--stacked .announcement-bar--item:hover {
        background-color: var(--hover-bg) !important;
        color: var(--hover-text) !important;
        transition: background-color 0.3s ease, color 0.3s ease;
        cursor: pointer;
      }

      .announcement-bar--stacked .announcement-bar--item:hover a {
        color: var(--hover-text) !important;
        text-decoration: none;
      }

      /* Ocultar en desktop */
      @media (min-width: 769px) {
        .announcement-bar--item.hide-desktop {
          display: none !important;
        }
      }

      /* Ocultar en mobile */
      @media (max-width: 768px) {
        .announcement-bar--item.hide-mobile {
          display: none !important;
        }
      }
    </style>

    <script>
      (function () {
        var bar = document.querySelector('.announcement-bar--fixed');
        if (!bar) return;

        // NO aplicar padding-top al body ya que usamos sticky positioning
        // El sticky positioning no requiere padding-top adicional
      })();
    </script>

  {%- endif -%}
{%- endif -%}

<style>
  .announcement-bar {
    --announcement-text-color: {{ section.settings.text_color }};
    color: var(--announcement-text-color); /* Para que el texto herede */
  }

  /* Los enlaces heredan el color */
  .announcement-bar a {
    color: inherit !important;
  }

  /* Iconos y flechas heredan color desde el padre */
  .announcement-bar .announcement-bar--item svg,
  .announcement-bar .announcement-bar--item svg path,
  .announcement-bar .flickity-nav svg,
  .announcement-bar .flickity-nav svg path {
    fill: currentColor !important;
    stroke: currentColor !important;
    color: inherit !important;
  }

  .announcement-bar--item {
    line-height: 1.1;
    padding: 0.1em 0; /* Ajuste de espacio vertical */
  }
  
  .announcement-bar {
    padding-top: 0.6em;
    padding-bottom: 0.6em;
  }
  
  .announcement-bar .flickity-nav {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    color: inherit !important;
    fill: currentColor !important;
    stroke: currentColor !important;
    padding: 0.3em;
    display: flex;
    align-items: center;
    justify-content: center;
  }
 
  .announcement-bar-sticky--active {
    position: sticky;
    top: 0;
    z-index: 9999; /* para que quede por encima */
  }

  /* Estilos fijos para announcement-bar--item - Aplicado a todos los dispositivos */
  .announcement-bar--item {
    background-color: #000000 !important;
    color: #ffffff !important;
    --hover-bg: #333333 !important;
    --hover-text: #ffffff !important;
  }

  .announcement-bar--item:hover {
    background-color: var(--hover-bg) !important;
    color: var(--hover-text) !important;
  }
</style>


{% schema %}
{
	"name": "Announcement bar",
	"class": "announcement-bar-section",
	"max_blocks": 5,
	"settings": [
		{
			"type": "checkbox",
			"id": "sticky_announcement-bar",
			"label": "Mantiene fijo announcement-bar",
			"default": true
		},
		{
			"type": "checkbox",
			"id": "announcement_bar",
			"label": "Oculta/Muestra announcement-bar",
			"default": true
		},
		{
			"type": "checkbox",
			"id": "announcement_bar_homepage_only",
			"label": "Show on home page only",
			"default": false
		},
		{
			"type": "select",
			"id": "announcement_bar_layout",
			"options": [
				{
					"value": "marquee",
					"label": "Marquee"
				},
				{
					"value": "carousel",
					"label": "Carousel"
				},
				{
					"value": "stacked",
					"label": "Stacked (Apilado)"
				}
			],
			"default": "marquee",
			"label": "Layout"
		},
		{
			"type": "header",
			"content": "Marquee"
		},
		{
			"type": "select",
			"id": "direction",
			"options": [
				{
					"value": "left",
					"label": "Left"
				},
				{
					"value": "right",
					"label": "Right"
				}
			],
			"default": "left",
			"label": "Direction"
		},
		{
			"type": "select",
			"id": "speed",
			"options": [
				{
					"value": "10s",
					"label": "Fast"
				},
				{
					"value": "20s",
					"label": "Normal"
				},
				{
					"value": "30s",
					"label": "Slow"
				},
				{
					"value": "50s",
					"label": "Very slow"
				}
			],
			"default": "20s",
			"label": "Speed"
		},
		{
			"type": "header",
			"content": "Carousel"
		},
		{
			"type": "checkbox",
			"id": "autoplay",
			"label": "Auto-rotate slides",
			"default": true
		},
		{
			"type": "range",
			"id": "autoplay_length",
			"min": 3,
			"max": 10,
			"step": 1,
			"unit": "s",
			"label": "Change slides every",
			"default": 5
		},
		{
			"type": "color",
			"id": "announcement_bg",
			"label": "Color de fondo",
			"default": "#000000"
		},
		{
			"type": "color",
			"id": "announcement_text",
			"label": "Color del texto",
			"default": "#ffffff"
		}
	],
	"blocks": [
		{
			"type": "text",
			"name": "Text",
			"settings": [
				{
					"type": "select",
					"id": "icon",
					"options": [
						{
							"value": "none",
							"label": "None"
						},
						{
							"value": "apple",
							"label": "Apple"
						},
						{
							"value": "banana",
							"label": "Banana"
						},
						{
							"value": "bottle",
							"label": "Bottle"
						},
						{
							"value": "box",
							"label": "Box"
						},
						{
							"value": "carrot",
							"label": "Carrot"
						},
						{
							"value": "chat_bubble",
							"label": "Chat bubble"
						},
						{
							"value": "check_mark",
							"label": "Check mark"
						},
						{
							"value": "clipboard",
							"label": "Clipboard"
						},
						{
							"value": "dairy",
							"label": "Dairy"
						},
						{
							"value": "dairy_free",
							"label": "Dairy free"
						},
						{
							"value": "dryer",
							"label": "Dryer"
						},
						{
							"value": "eye",
							"label": "Eye"
						},
						{
							"value": "fire",
							"label": "Fire"
						},
						{
							"value": "gluten_free",
							"label": "Gluten free"
						},
						{
							"value": "heart",
							"label": "Heart"
						},
						{
							"value": "iron",
							"label": "Iron"
						},
						{
							"value": "leaf",
							"label": "Leaf"
						},
						{
							"value": "leather",
							"label": "Leather"
						},
						{
							"value": "lightning_bolt",
							"label": "Lightning bolt"
						},
						{
							"value": "lipstick",
							"label": "Lipstick"
						},
						{
							"value": "lock",
							"label": "Lock"
						},
						{
							"value": "map_pin",
							"label": "Map pin"
						},
						{
							"value": "nut_free",
							"label": "Nut free"
						},
						{
							"value": "pants",
							"label": "Pants"
						},
						{
							"value": "paw_print",
							"label": "Paw print"
						},
						{
							"value": "pepper",
							"label": "Pepper"
						},
						{
							"value": "perfume",
							"label": "Perfume"
						},
						{
							"value": "plane",
							"label": "Plane"
						},
						{
							"value": "plant",
							"label": "Plant"
						},
						{
							"value": "price_tag",
							"label": "Price tag"
						},
						{
							"value": "question_mark",
							"label": "Question mark"
						},
						{
							"value": "recycle",
							"label": "Recycle"
						},
						{
							"value": "return",
							"label": "Return"
						},
						{
							"value": "ruler",
							"label": "Ruler"
						},
						{
							"value": "serving_dish",
							"label": "Serving dish"
						},
						{
							"value": "shirt",
							"label": "Shirt"
						},
						{
							"value": "shoe",
							"label": "Shoe"
						},
						{
							"value": "silhouette",
							"label": "Silhouette"
						},
						{
							"value": "snowflake",
							"label": "Snowflake"
						},
						{
							"value": "star",
							"label": "Star"
						},
						{
							"value": "stopwatch",
							"label": "Stopwatch"
						},
						{
							"value": "truck",
							"label": "Truck"
						},
						{
							"value": "washing",
							"label": "Washing"
						}
					],
					"default": "none",
					"label": "Icon"
				},
				{
					"type": "text",
					"id": "text",
					"label": "Content",
					"default": "Add campaign text here."
				},
				{
					"id": "link",
					"type": "url",
					"label": "Link"
				},
				{
					"type": "color",
					"id": "item_bg_color",
					"label": "Color de fondo del texto",
					"default": "#000000"
				},
				{
					"type": "color",
					"id": "item_text_color",
					"label": "Color del texto",
					"default": "#ffffff"
				},
				{
					"type": "color",
					"id": "item_hover_bg_color",
					"label": "Color de fondo en hover",
					"default": "#333333"
				},
				{
					"type": "color",
					"id": "item_hover_text_color",
					"label": "Color del texto en hover",
					"default": "#ffffff"
				},
				{
					"type": "checkbox",
					"id": "hide_on_desktop",
					"label": "Hide on desktop",
					"default": false
				},
				{
					"type": "checkbox",
					"id": "hide_on_mobile",
					"label": "Hide on mobile",
					"default": false
				}
			]
		}
	],
	"default": {
		"blocks": [
			{
				"type": "text"
			},
			{
				"type": "text"
			},
			{
				"type": "text"
			},
			{
				"type": "text"
			}
		]
	}
}
{% endschema %}